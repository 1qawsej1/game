<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroid Defense Mission Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ef4444;
            border-radius: 10px;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { border-color: #ef4444; }
            50% { border-color: #ff6b6b; }
        }
        h1 {
            font-size: 2.5em;
            color: #ef4444;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }
        .threat-level {
            font-size: 1.2em;
            color: #fbbf24;
            font-weight: bold;
        }
        .screen {
            display: none;
            animation: fadeIn 0.5s;
        }
        .screen.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .panel {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid #3b82f6;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .panel h2 {
            color: #60a5fa;
            font-size: 1.5em;
            margin-bottom: 15px;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .info-card {
            background: rgba(15, 23, 42, 0.8);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .info-label {
            color: #94a3b8;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .info-value {
            color: #60a5fa;
            font-size: 1.3em;
            font-weight: bold;
        }
        .tech-option {
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid #334155;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tech-option:hover {
            border-color: #3b82f6;
            transform: translateX(5px);
        }
        .tech-option.selected {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }
        .tech-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .tech-name {
            font-size: 1.2em;
            color: #60a5fa;
            font-weight: bold;
        }
        .tech-cost {
            color: #fbbf24;
            font-size: 1.1em;
        }
        .tech-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        .stat {
            color: #94a3b8;
        }
        .stat-value {
            color: #22c55e;
            font-weight: bold;
        }
        .budget-panel {
            background: rgba(15, 23, 42, 0.9);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #fbbf24;
            margin: 20px 0;
        }
        .budget-bar {
            background: #1e293b;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }
        .budget-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #10b981);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .budget-fill.warning {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }
        .budget-fill.danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }
        .timeline {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .phase {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            border-left: 4px solid #64748b;
        }
        .phase.active {
            border-left-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        .phase.complete {
            border-left-color: #22c55e;
            opacity: 0.7;
        }
        .phase-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #334155;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        .phase.active .phase-number {
            background: #3b82f6;
        }
        .phase.complete .phase-number {
            background: #22c55e;
        }
        .phase-info {
            flex: 1;
        }
        .phase-name {
            font-weight: bold;
            color: #e2e8f0;
            margin-bottom: 5px;
        }
        .phase-duration {
            color: #94a3b8;
            font-size: 0.9em;
        }
        .btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            margin: 10px 5px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        .btn:disabled {
            background: #475569;
            cursor: not-allowed;
            transform: none;
        }
        .btn-success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        canvas {
            width: 100%;
            max-width: 600px;
            height: 400px;
            border: 1px solid #334155;
            border-radius: 8px;
            background: #0a0e27;
            display: block;
            margin: 20px auto;
        }
        .result-panel {
            text-align: center;
            padding: 40px;
        }
        .result-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }
        .result-title {
            font-size: 2em;
            margin-bottom: 15px;
        }
        .result-message {
            font-size: 1.2em;
            color: #94a3b8;
            margin-bottom: 30px;
        }
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        .alert {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #fca5a5;
        }
        .success-alert {
            background: rgba(34, 197, 94, 0.2);
            border-color: #22c55e;
            color: #86efac;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚠️ PLANETARY DEFENSE COMMAND</h1>
            <div class="threat-level">THREAT LEVEL: CRITICAL</div>
            <div style="margin-top: 10px; color: #e2e8f0;">Mission: Deflect Asteroid IMPACTOR-2025</div>
        </div>

        <!-- Screen 1: Threat Analysis -->
        <div id="screen1" class="screen active">
            <div class="panel">
                <h2>THREAT ANALYSIS</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Our telescopes have detected a near-Earth asteroid on a collision course with our planet. 
                    You have been appointed as Mission Director to plan and execute a deflection mission.
                </p>
                
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">Asteroid Diameter</div>
                        <div class="info-value" id="asteroid-size">350m</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Approach Velocity</div>
                        <div class="info-value">18 km/s</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Time to Impact</div>
                        <div class="info-value" id="time-to-impact">540 days</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Composition</div>
                        <div class="info-value">Stony</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Impact Energy</div>
                        <div class="info-value">2,500 MT</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Threat Level</div>
                        <div class="info-value" style="color: #ef4444;">EXTREME</div>
                    </div>
                </div>

                <canvas id="orbit-canvas" width="600" height="400"></canvas>

                <div class="alert">
                    <strong>⚠️ IMPACT CONSEQUENCES:</strong> If this asteroid strikes Earth, it will release energy equivalent to 2,500 megatons of TNT, 
                    creating a 5km diameter crater and devastating everything within 50km radius. Your mission is to prevent this catastrophe.
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-success" onclick="goToScreen(2)">BEGIN MISSION PLANNING →</button>
                </div>
            </div>
        </div>

        <!-- Screen 2: Technology Selection -->
        <div id="screen2" class="screen">
            <div class="panel">
                <h2>DEFLECTION TECHNOLOGY SELECTION</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Choose your deflection method. Each technology has different costs, success rates, and time requirements.
                </p>

                <div class="budget-panel">
                    <h3 style="color: #fbbf24; margin-bottom: 10px;">Mission Budget</h3>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Allocated: <strong id="budget-total">$5.0B</strong></span>
                        <span>Remaining: <strong id="budget-remaining">$5.0B</strong></span>
                    </div>
                    <div class="budget-bar">
                        <div class="budget-fill" id="budget-bar" style="width: 100%">100%</div>
                    </div>
                </div>

                <div id="tech-options">
                    <div class="tech-option" onclick="selectTech('kinetic')">
                        <div class="tech-header">
                            <div class="tech-name">🚀 KINETIC IMPACTOR</div>
                            <div class="tech-cost">$1.2B</div>
                        </div>
                        <p style="color: #94a3b8; margin: 10px 0;">
                            Launch a high-speed spacecraft to collide with the asteroid, transferring momentum to alter its trajectory.
                        </p>
                        <div class="tech-stats">
                            <div class="stat">Success Rate: <span class="stat-value">10%</span></div>
                            <div class="stat">Mission Duration: <span class="stat-value">14 months</span></div>
                            <div class="stat">Technology: <span class="stat-value">Proven (DART Mission)</span></div>
                            <div class="stat">Risk Level: <span class="stat-value">Medium</span></div>
                        </div>
                    </div>

                    <div class="tech-option" onclick="selectTech('gravity')">
                        <div class="tech-header">
                            <div class="tech-name">🛸 GRAVITY TRACTOR</div>
                            <div class="tech-cost">$2.8B</div>
                        </div>
                        <p style="color: #94a3b8; margin: 10px 0;">
                            Position a spacecraft near the asteroid to use gravitational forces to gradually pull it off course.
                        </p>
                        <div class="tech-stats">
                            <div class="stat">Success Rate: <span class="stat-value">5%</span></div>
                            <div class="stat">Mission Duration: <span class="stat-value">20 months</span></div>
                            <div class="stat">Technology: <span class="stat-value">Experimental</span></div>
                            <div class="stat">Risk Level: <span class="stat-value">Low</span></div>
                        </div>
                    </div>

                    <div class="tech-option" onclick="selectTech('nuclear')">
                        <div class="tech-header">
                            <div class="tech-name">☢️ NUCLEAR DEFLECTION</div>
                            <div class="tech-cost">$2.0B</div>
                        </div>
                        <p style="color: #94a3b8; margin: 10px 0;">
                            Detonate a nuclear device near the asteroid surface to vaporize material and create thrust for deflection.
                        </p>
                        <div class="tech-stats">
                            <div class="stat">Success Rate: <span class="stat-value">95%</span></div>
                            <div class="stat">Mission Duration: <span class="stat-value">16 months</span></div>
                            <div class="stat">Technology: <span class="stat-value">Theoretical</span></div>
                            <div class="stat">Risk Level: <span class="stat-value">High</span></div>
                        </div>
                    </div>

                    <div class="tech-option" onclick="selectTech('laser')">
                        <div class="tech-header">
                            <div class="tech-name">🔬 LASER ABLATION</div>
achel                            <div class="tech-cost">$3.5B</div>
                        </div>
                        <p style="color: #94a3b8; margin: 10px 0;">
                            Use high-powered lasers to vaporize asteroid surface material, creating thrust through ablation.
                        </p>
                        <div class="tech-stats">
                            <div class="stat">Success Rate: <span class="stat-value">5%</span></div>
                            <div class="stat">Mission Duration: <span class="stat-value">18 months</span></div>
                            <div class="stat">Technology: <span class="stat-value">Experimental</span></div>
                            <div class="stat">Risk Level: <span class="stat-value">Very High</span></div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="goToScreen(1)">← BACK</button>
                    <button class="btn btn-success" id="confirm-tech" onclick="goToScreen(3)" disabled>CONFIRM SELECTION →</button>
                </div>
            </div>
        </div>

        <!-- Screen 3: Mission Timeline -->
        <div id="screen3" class="screen">
            <div class="panel">
                <h2>MISSION TIMELINE</h2>
                <p style="color: #94a3b8; margin-bottom: 20px;">
                    Your mission will proceed through the following phases. Monitor progress and make critical decisions.
                </p>

                <div class="timeline" id="timeline">
                    <!-- Phases will be generated by JavaScript -->
                </div>

                <div class="budget-panel">
                    <h3 style="color: #fbbf24; margin-bottom: 10px;">Mission Status</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div class="info-label">Days Elapsed</div>
                            <div class="info-value" id="days-elapsed">0</div>
                        </div>
                        <div>
                            <div class="info-label">Days Remaining</div>
                            <div class="info-value" id="days-remaining">540</div>
                        </div>
                        <div>
                            <div class="info-label">Mission Phase</div>
                            <div class="info-value" id="current-phase">Planning</div>
                        </div>
                        <div>
                            <div class="info-label">Success Probability</div>
                            <div class="info-value" id="success-prob">0%</div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="goToScreen(2)">← BACK</button>
                    <button class="btn btn-success" onclick="startMission()">LAUNCH MISSION →</button>
                </div>
            </div>
        </div>

        <!-- Screen 4: Mission Execution -->
        <div id="screen4" class="screen">
            <div class="panel">
                <h2>MISSION EXECUTION</h2>
                
                <div id="mission-log" style="background: rgba(15, 23, 42, 0.8); padding: 20px; border-radius: 8px; height: 300px; overflow-y: auto; margin: 20px 0; font-family: 'Courier New', monospace; font-size: 0.9em;">
                    <div style="color: #22c55e;">&gt; MISSION CONTROL INITIALIZED...</div>
                </div>

                <canvas id="trajectory-canvas" width="600" height="400"></canvas>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-success" id="continue-mission" onclick="continueMission()" disabled>CONTINUE →</button>
                </div>
            </div>
        </div>

        <!-- Screen 5: Results -->
        <div id="screen5" class="screen">
            <div class="panel result-panel">
                <div class="result-icon" id="result-icon">🎯</div>
                <div class="result-title" id="result-title">MISSION OUTCOME</div>
                <div class="result-message" id="result-message">Calculating results...</div>
                
                <div class="stats-summary">
                    <div class="info-card">
                        <div class="info-label">Final Cost</div>
                        <div class="info-value" id="final-cost">$0B</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Mission Duration</div>
                        <div class="info-value" id="final-duration">0 days</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Deflection Distance</div>
                        <div class="info-value" id="deflection-distance">0 km</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Final Score</div>
                        <div class="info-value" id="final-score">0</div>
                    </div>
                </div>

                <div id="result-details" style="text-align: left; max-width: 600px; margin: 0 auto; padding: 20px; background: rgba(15, 23, 42, 0.8); border-radius: 8px;">
                    <!-- Details will be filled by JavaScript -->
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-success" onclick="resetMission()">🔄 NEW MISSION</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        var missionData = {
            budget: 5.0,
            budgetUsed: 0,
            selectedTech: null,
            timeToImpact: 540,
            daysElapsed: 0,
            currentPhase: 0,
            missionPhases: [],
            success: false,
            techData: {
                kinetic: { name: 'Kinetic Impactor', cost: 1.2, success: 10, duration: 14, icon: '🚀' },
                gravity: { name: 'Gravity Tractor', cost: 2.8, success: 5, duration: 20, icon: '🛸' },
                nuclear: { name: 'Nuclear Deflection', cost: 2.0, success: 95, duration: 16, icon: '☢️' },
                laser: { name: 'Laser Ablation', cost: 3.5, success: 5, duration: 18, icon: '🔬' }
            }
        };

        function goToScreen(num) {
            var screens = document.querySelectorAll('.screen');
            for (var i = 0; i < screens.length; i++) {
                screens[i].classList.remove('active');
            }
            document.getElementById('screen' + num).classList.add('active');
        }

        function selectTech(tech) {
            missionData.selectedTech = tech;
            missionData.budgetUsed = missionData.techData[tech].cost;
            
            var options = document.querySelectorAll('.tech-option');
            for (var i = 0; i < options.length; i++) {
                options[i].classList.remove('selected');
            }
            event.target.closest('.tech-option').classList.add('selected');
            
            updateBudget();
            document.getElementById('confirm-tech').disabled = false;
            document.getElementById('success-prob').textContent = missionData.techData[tech].success + '%';
        }

        function updateBudget() {
            var remaining = missionData.budget - missionData.budgetUsed;
            var percentage = (remaining / missionData.budget) * 100;
            
            document.getElementById('budget-remaining').textContent = '$' + remaining.toFixed(1) + 'B';
            document.getElementById('budget-bar').style.width = percentage + '%';
            document.getElementById('budget-bar').textContent = Math.round(percentage) + '%';
            
            var bar = document.getElementById('budget-bar');
            bar.classList.remove('warning', 'danger');
            if (percentage < 50) bar.classList.add('warning');
            if (percentage < 25) bar.classList.add('danger');
        }

        function generateTimeline() {
            var tech = missionData.techData[missionData.selectedTech];
            var phases = [
                { name: 'Mission Planning', duration: 2 },
                { name: 'Spacecraft Design', duration: 4 },
                { name: 'Manufacturing', duration: 6 },
                { name: 'Launch Preparation', duration: 1 },
                { name: 'Transit to Asteroid', duration: tech.duration - 13 },
                { name: 'Deflection Execution', duration: 0.5 },
                { name: 'Verification', duration: 0.5 }
            ];
            
            missionData.missionPhases = phases;
            
            var timeline = document.getElementById('timeline');
            timeline.innerHTML = '';
            
            for (var i = 0; i < phases.length; i++) {
                var phase = phases[i];
                var div = document.createElement('div');
                div.className = 'phase';
                div.innerHTML = '<div class="phase-number">' + (i + 1) + '</div>' +
                               '<div class="phase-info">' +
                               '<div class="phase-name">' + phase.name + '</div>' +
                               '<div class="phase-duration">Duration: ' + Math.round(phase.duration * 30) + ' days</div>' +
                               '</div>';
                timeline.appendChild(div);
            }
        }

        function startMission() {
            generateTimeline();
            goToScreen(4);
            missionData.daysElapsed = 0;
            missionData.currentPhase = 0;
            executeMission();
        }

        function executeMission() {
            var log = document.getElementById('mission-log');
            var phases = missionData.missionPhases;
            var phaseIndex = 0;
            
            function logMessage(msg, color) {
                color = color || '#22c55e';
                var div = document.createElement('div');
                div.style.color = color;
                div.textContent = '> ' + msg;
                log.appendChild(div);
                log.scrollTop = log.scrollHeight;
            }
            
            logMessage('INITIATING MISSION SEQUENCE...', '#60a5fa');
            logMessage('Selected Technology: ' + missionData.techData[missionData.selectedTech].name, '#fbbf24');
            
            var interval = setInterval(function() {
                if (phaseIndex >= phases.length) {
                    clearInterval(interval);
                    logMessage('MISSION SEQUENCE COMPLETE', '#22c55e');
                    document.getElementById('continue-mission').disabled = false;
                    return;
                }
                
                var phase = phases[phaseIndex];
                logMessage('Phase ' + (phaseIndex + 1) + ': ' + phase.name + ' - INITIATED', '#60a5fa');
                
                setTimeout(function() {
                    var roll = Math.random();
                    if (roll > 0.8 && missionData.selectedTech !== 'nuclear') {
                        logMessage('  ⚠ Critical complication detected - insufficient energy transfer', '#f59e0b');
                    } else {
                        logMessage('  ✓ Phase completed successfully', '#22c55e');
                    }
                    
                    missionData.daysElapsed += Math.round(phase.duration * 30);
                    phaseIndex++;
                }, 1500);
                
            }, 3000);
            
            drawTrajectory();
        }

        function continueMission() {
            calculateResults();
            goToScreen(5);
        }

        function calculateResults() {
            var tech = missionData.techData[missionData.selectedTech];
            var roll = Math.random() * 100;
            missionData.success = roll <= tech.success;
            
            var resultIcon = document.getElementById('result-icon');
            var resultTitle = document.getElementById('result-title');
            var resultMessage = document.getElementById('result-message');
            var resultDetails = document.getElementById('result-details');
            
            if (missionData.success && missionData.selectedTech === 'nuclear') {
                resultIcon.textContent = '🎉';
                resultTitle.textContent = 'MISSION SUCCESS!';
                resultTitle.style.color = '#22c55e';
                resultMessage.textContent = 'The asteroid has been successfully deflected. Earth is safe!';
                
                var deflection = Math.round(15000 + Math.random() * 5000);
                var score = Math.round((tech.success * 10) + (missionData.budget - missionData.budgetUsed) * 200);
                
                resultDetails.innerHTML = '<div class="success-alert">' +
                    '<strong>✓ DEFLECTION CONFIRMED</strong><br>' +
                    'The nuclear deflection successfully altered the asteroid trajectory by ' + deflection + ' kilometers. ' +
                    'Impact probability reduced to 0.00%. All tracking stations confirm Earth is no longer in danger. ' +
                    'Mission completed ' + (missionData.timeToImpact - missionData.daysElapsed) + ' days ahead of impact deadline.' +
                    '</div>';
                
                document.getElementById('deflection-distance').textContent = deflection.toLocaleString() + ' km';
                document.getElementById('final-score').textContent = score.toLocaleString();
            } else {
                resultIcon.textContent = '⚠️';
                resultTitle.textContent = 'MISSION FAILED';
                resultTitle.style.color = '#ef4444';
                resultMessage.textContent = 'The deflection attempt was insufficient. Emergency protocols activated.';
                
                resultDetails.innerHTML = '<div class="alert">' +
                    '<strong>⚠ DEFLECTION INCOMPLETE</strong><br>' +
                    (missionData.selectedTech === 'nuclear' ? 
                        'Despite using nuclear deflection, unexpected technical issues prevented sufficient trajectory change. ' :
                        'The selected technology (' + tech.name + ') lacked the necessary energy to deflect the asteroid effectively. ') +
                    'Some trajectory change was achieved, but it was not sufficient to prevent impact. ' +
                    'Global emergency response teams have been activated. Evacuation procedures are now in effect for predicted impact zones.' +
                    '</div>';
                
                document.getElementById('deflection-distance').textContent = Math.round(Math.random() * 5000) + ' km';
                document.getElementById('final-score').textContent = '0';
            }
            
            document.getElementById('final-cost').textContent = '$' + missionData.budgetUsed.toFixed(1) + 'B';
            document.getElementById('final-duration').textContent = missionData.daysElapsed + ' days';
        }

        function drawOrbit() {
            var canvas = document.getElementById('orbit-canvas');
            if (!canvas) return;
            var ctx = canvas.getContext('2d');
            var w = canvas.width;
            var h = canvas.height;
            
            ctx.fillStyle = '#0a0e27';
            ctx.fillRect(0, 0, w, h);
            
            var centerX = w / 2;
            var centerY = h / 2;
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, 50, 0, 6.28);
            ctx.fillStyle = '#3b82f6';
            ctx.fill();
            
            ctx.font = '14px Arial';
            ctx.fillStyle = '#fff';
            ctx.textAlign = 'center';
            ctx.fillText('EARTH', centerX, centerY + 5);
            
            ctx.strokeStyle = '#60a5fa';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.ellipse(centerX, centerY, 200, 150, 0, 0, 6.28);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX + 200, centerY);
            ctx.lineTo(centerX, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(centerX + 200, centerY, 15, 0, 6.28);
            ctx.fillStyle = '#ef4444';
            ctx.fill();
            
            ctx.font = '12px Arial';
            ctx.fillStyle = '#ef4444';
            ctx.textAlign = 'left';
            ctx.fillText('IMPACTOR-2025', centerX + 220, centerY + 5);
            
            ctx.strokeStyle = '#fbbf24';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX + 200, centerY);
            ctx.lineTo(centerX + 100, centerY - 80);
            ctx.stroke();
            
            ctx.fillStyle = '#fbbf24';
            ctx.fillText('Deflection', centerX + 110, centerY - 90);
            ctx.fillText('Trajectory', centerX + 110, centerY - 75);
        }

        function drawTrajectory() {
            var canvas = document.getElementById('trajectory-canvas');
            if (!canvas) return;
            var ctx = canvas.getContext('2d');
            var w = canvas.width;
            var h = canvas.height;
            
            ctx.fillStyle = '#0a0e27';
            ctx.fillRect(0, 0, w, h);
            
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, h / 2);
            ctx.lineTo(w - 50, h / 2);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(100, h / 2, 30, 0, 6.28);
            ctx.fillStyle = '#3b82f6';
            ctx.fill();
            
            ctx.fillStyle = '#fff';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('EARTH', 100, h / 2 + 50);
            
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.moveTo(w - 100, 100);
            ctx.quadraticCurveTo(w / 2, h / 2 - 50, 100, h / 2);
            ctx.stroke();
            
            ctx.strokeStyle = '#22c55e';
            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.moveTo(w - 100, 100);
            ctx.quadraticCurveTo(w / 2, h / 2 + 100, 100, h - 100);
            ctx.stroke();
            
            ctx.fillStyle = '#ef4444';
            ctx.fillText('Original Path', w / 2, 120);
            ctx.fillStyle = '#22c55e';
            ctx.fillText('Deflected Path', w / 2, h - 80);
        }

        function resetMission() {
            missionData.selectedTech = null;
            missionData.budgetUsed = 0;
            missionData.daysElapsed = 0;
            missionData.currentPhase = 0;
            updateBudget();
            goToScreen(1);
            drawOrbit();
        }

        window.onload = function() {
            drawOrbit();
        };
    </script>
</body>
</html>