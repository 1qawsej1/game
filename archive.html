<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Archive</title>
<style>
body {
  margin: 0;
  height: 100vh;
  background: url('Archive.png') no-repeat center center/cover;
  position: relative;
  overflow: hidden;
  font-family: 'Segoe UI', sans-serif;
}

/* 门样式 */
.door {
  position: absolute;
  top: 195px;
  width: 62px;
  height: 345px;
  background: rgba(255, 255, 255, 0);
  display: flex;
  justify-content: center;
  align-items: flex-end;
}
.room-bar {
  background: rgba(0, 0, 0, 0.6);
  color: white;
  text-align: center;
  font-size: 14px;
  padding: 6px 20px;
  border-radius: 0 0 8px 8px;
  opacity: 0;
  transform: translateY(100%);
  transition: all 0.3s ease;
  pointer-events: none;
  min-width: 120px;
  width: fit-content;
}
.door.active .room-bar { opacity: 1; transform: translateY(0); }

/* 角色 */
#character {
  position: absolute;
  width: 15vw;
  aspect-ratio: 2/3;
  background: url('1234.png') no-repeat center/contain;
  z-index: 5;
  transition: transform 0.3s ease-in-out;
  visibility: hidden;
}

/* 右门触发照片弹出面板 */
.door.photo-door {
  width: 600px;
  height: 500px;
  top: 0px;
  right: 20px;
}

/* 照片面板 */
#photo-panel {
  position: fixed;
  top: 0;
  right: -100%;
  width: 80%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  backdrop-filter: blur(5px);
  transition: right 0.6s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  z-index: 100;
}
#photo-panel.active { right: 0; }
#photo-panel img {
  max-width: 80%;
  max-height: 80%;
  border-radius: 8px;
  box-shadow: 0 0 15px #000;
  opacity: 0;
  transition: opacity 0.4s ease;
  position: absolute;
}
#photo-panel img.active { opacity: 1; position: relative; }

/* 面板控制 */
#close-panel {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 28px;
  color: white;
  cursor: pointer;
}
#close-panel:hover { color: #0ff; }

/* 左右箭头 */
#prev, #next {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 50px;
  color: white;
  cursor: pointer;
  user-select: none;
  padding: 10px;
}
#prev { left: 20px; }
#next { right: 20px; }
#prev:hover, #next:hover { color: #0ff; }

</style>
</head>
<body>

<!-- 左门 -->
<div class="door" style="left: 25px;" data-target="index.html">
  <div class="room-bar">Main Lab</div>
</div>

<!-- 右门 -->
<div class="door photo-door" data-type="photo">
  <div class="room-bar">Open Archive Photos</div>
</div>

<!-- 角色 -->
<div id="character"></div>

<!-- 照片面板 -->
<div id="photo-panel">
  <span id="close-panel">✖</span>
  <span id="prev">&#10094;</span>
  <span id="next">&#10095;</span>
  <img src="img1.png" class="active" alt="Photo 1">
  <img src="img2.png" alt="Photo 2">
  <img src="img3.png" alt="Photo 3">
  <img src="img4.png" alt="Photo 4">
  <img src="img5.png" alt="Photo 5">
  <img src="img6.png" alt="Photo 6">
  <img src="img7.png" alt="Photo 7">
  <img src="img8.png" alt="Photo 8">
  <img src="img9.png" alt="Photo 9">
</div>

<script>
// 角色和门逻辑
const character = document.getElementById("character");
const doors = document.querySelectorAll(".door");
const photoPanel = document.getElementById("photo-panel");
const closePanel = document.getElementById("close-panel");

let x, y;
const speed = 10;
let facingRight = true;
let sway = 0, swayDir = 1;
const groundOffset = window.innerHeight * 0.05;

character.style.visibility = "hidden";

function initPosition() {
  x = (window.innerWidth - character.offsetWidth) / 2;
  y = window.innerHeight - character.offsetHeight - groundOffset;
  character.style.left = x + "px";
  character.style.top = y + "px";
  character.style.visibility = "visible";
}

function updateCharacter() {
  sway += swayDir * 0.2;
  if (sway > 4 || sway < -4) swayDir *= -1;
  character.style.left = `${x}px`;
  character.style.top = `${y + sway}px`;
  character.style.transform = `scaleX(${facingRight ? 1 : -1})`;
}

function checkCollision() {
  const charBox = { left: x, right: x + character.offsetWidth, top: y, bottom: y + character.offsetHeight };
  let collidedDoor = null;
  doors.forEach(door => {
    const r = { left: door.offsetLeft, right: door.offsetLeft + door.offsetWidth, top: door.offsetTop, bottom: door.offsetTop + door.offsetHeight };
    const overlap = charBox.right > r.left && charBox.left < r.right && charBox.bottom > r.top && charBox.top < r.bottom;
    if (overlap) {
      door.classList.add("active");
      collidedDoor = door;
    } else door.classList.remove("active");
  });
  return collidedDoor;
}

function loop() { updateCharacter(); requestAnimationFrame(loop); }
loop();

window.addEventListener('load', initPosition);
window.addEventListener('resize', initPosition);

document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') { x -= speed; facingRight = false; e.preventDefault(); }
  if (e.key === 'ArrowRight') { x += speed; facingRight = true; e.preventDefault(); }
  if (e.key === 'ArrowUp') { y -= speed; e.preventDefault(); }
  if (e.key === 'ArrowDown') { y += speed; e.preventDefault(); }

  const maxX = window.innerWidth - character.offsetWidth;
  const maxY = window.innerHeight - character.offsetHeight - groundOffset / 2;
  x = Math.max(0, Math.min(maxX, x));
  y = Math.max(0, Math.min(maxY, y));

  const collided = checkCollision();
  if (e.key === 'Enter' || e.key === ' ') {
    if (collided) {
      if (collided.dataset.type === 'photo') photoPanel.classList.add('active');
      else if (collided.dataset.target) window.location.href = collided.dataset.target;
    }
  }
});

// 照片轮播
const images = photoPanel.querySelectorAll('img');
let currentIndex = 0;
function showImage(index) {
  images.forEach((img, i) => img.classList.toggle('active', i === index));
}
document.getElementById('prev').onclick = () => {
  currentIndex = (currentIndex - 1 + images.length) % images.length;
  showImage(currentIndex);
};
document.getElementById('next').onclick = () => {
  currentIndex = (currentIndex + 1) % images.length;
  showImage(currentIndex);
};

closePanel.onclick = () => photoPanel.classList.remove('active');

</script>
</body>
</html>
