<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simulation Lab</title>
<style>
body {
  margin: 0;
  height: 100vh;
  background: url('Simulationlab.png') no-repeat center center/cover;
  position: relative;
  overflow: hidden;
  font-family: 'Segoe UI', sans-serif;
}

/* 门按钮样式 */
.door {
  position: absolute;
  top: 195px;
  width: 62px;
  height: 345px;
  background: rgba(255,255,255,0);
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

.room-bar {
  width: max-content;
  min-width: 100px;
  padding: 5px 14px;
  background: rgba(0,0,0,0.6);
  color: white;
  text-align: center;
  font-size: 14px;
  border-radius: 0 0 5px 5px;
  opacity: 0;
  transform: translateY(100%);
  transition: all 0.3s ease;
  pointer-events: none;
}

.door.active .room-bar {
  opacity: 1;
  transform: translateY(0);
}

/* 角色 */
#character {
  position: absolute;
  width: 15vw;
  aspect-ratio: 2/3;
  background: url('1234.png') no-repeat center/contain;
  pointer-events: none;
  z-index: 5;
  transition: transform 0.3s ease-in-out;
}

/* Meteor Simulator 面板 (iframe) */
#simulator-panel {
  position: fixed;
  top: -100%;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.95);
  transition: top 0.5s ease;
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;
}

#simulator-panel.active {
  top: 0;
}

#simulator-panel iframe {
  width: 90%;
  height: 90%;
  border: none;
  border-radius: 10px;
}

#close-simulator {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 28px;
  cursor: pointer;
  color: #fff;
}
#close-simulator:hover { color: #0ff; }

</style>
</head>
<body>

<!-- 角色 -->
<div id="character"></div>

<!-- 左边门按钮 -->
<div class="door" style="left:30px;" data-type="simulator">
  <div class="room-bar">Meteor Impact Simulator</div>
</div>

<!-- 其他门 -->
<div class="door" style="left:1195px;" data-target="index.html">
  <div class="room-bar">Main Lab</div>
</div>

<!-- Meteor Simulator 面板 -->
<div id="simulator-panel">
  <span id="close-simulator">✖</span>
  <!-- iframe 嵌入 HTML 文件 -->
  <iframe src="meteor.html"></iframe>
</div>

<script>
const character = document.getElementById("character");
const doors = document.querySelectorAll(".door");
const simulatorPanel = document.getElementById("simulator-panel");
const closeSimulator = document.getElementById("close-simulator");

let x=600, y=400;
const speed=10;
let facingRight=true;

function checkCollision(){
  let collided=null;
  const charBox=character.getBoundingClientRect();
  doors.forEach(d=>{
    const r=d.getBoundingClientRect();
    if(charBox.right>r.left && charBox.left<r.right && charBox.bottom>r.top && charBox.top<r.bottom){
      d.classList.add("active");
      collided=d;
    } else d.classList.remove("active");
  });
  return collided;
}

// 键盘控制
document.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft'){ x-=speed; facingRight=false; e.preventDefault(); }
  if(e.key==='ArrowRight'){ x+=speed; facingRight=true; e.preventDefault(); }
  if(e.key==='ArrowUp'){ y-=speed; e.preventDefault(); }
  if(e.key==='ArrowDown'){ y+=speed; e.preventDefault(); }

  // 边界
  const maxX=window.innerWidth-character.offsetWidth;
  const maxY=window.innerHeight-character.offsetHeight;
  x=Math.max(0, Math.min(maxX,x));
  y=Math.max(0, Math.min(maxY,y));

  character.style.left=x+'px';
  character.style.top=y+'px';
  character.style.transform=`scaleX(${facingRight?1:-1})`;

  const collided = checkCollision();

  // 按 Enter 打开模拟器
  if((e.key==='Enter'||e.key===' ') && collided){
    if(collided.dataset.type==='simulator'){
      simulatorPanel.classList.add('active');
    } else if(collided.dataset.target){
      window.location.href=collided.dataset.target;
    }
  }
});

// 关闭面板
closeSimulator.onclick = ()=>simulatorPanel.classList.remove('active');

</script>

</body>
</html>
