<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Room 1</title>
<style>
body {
  margin: 0;
  height: 100vh;
  background: url('researchlab.png') no-repeat center center/cover;
  position: relative;
  overflow: hidden;
}

.door { 
  position:absolute; 
  top:50%; 
  transform:translateY(-50%); 
  width:70px; 
  height:30vh; 
  display:flex; 
  justify-content:center; 
  align-items:flex-end; 
  z-index:9; 
}

.room-bar { 
  width:max-content; 
  min-width:100px; 
  padding:5px 14px; 
  background:rgba(0,0,0,0.6); 
  color:white; 
  text-align:center; 
  font-size:14px; 
  border-radius:0 0 5px 5px; 
  opacity:0; 
  transform:translateY(100%); 
  transition:all 0.3s ease; 
  pointer-events:none; 
  z-index:10; 
}

.door.active .room-bar { 
  opacity:1; 
  transform:translateY(0); 
}

#character {
  position:absolute;
  width:15vw;
  aspect-ratio:2/3;
  background: url('1234.png') no-repeat center/contain;
  pointer-events:none;
  z-index:5;
  transition: transform 0.3s ease-in-out;
}

/* ===== Mission Control 滑出面板 ===== */
#mission-panel {
  position: fixed;
  top: -100%;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(8px);
  transition: top 0.6s ease;
  z-index: 100;
  display: flex;
  justify-content: center;
  align-items: center;
}

#mission-panel.active {
  top: 0;
}

#mission-panel iframe {
  width: 90%;
  height: 90%;
  border: none;
  border-radius: 15px;
}

#close-mission {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 28px;
  color: white;
  cursor: pointer;
}
#close-mission:hover { color: #0ff; }

/* ===== 红色闪烁 Overlay ===== */
#alert-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,0,0,0.3); /* 红色半透明 */
  pointer-events: none; /* 不阻挡鼠标和键盘 */
  z-index: 999; /* 盖在最上面 */
  animation: flash 1s infinite; /* 闪烁动画 */
}

@keyframes flash {
  0%, 100% { opacity: 0; }
  50% { opacity: 0.5; }
}
</style>
</head>
<body>

<!-- 左边门 -->
<div class="door" style="left:30px;" data-target="simulationlab.html">
  <div class="room-bar">Simulation Lab</div>
</div>

<!-- Mission Control 门 -->
<div class="door" style="left:35%;" data-type="mission">
  <div class="room-bar">Mission Control</div>
</div>

<!-- Exit 门 -->
<div class="door" style="left:65%;" data-target="index.html">
  <div class="room-bar">Exit</div>
</div>

<!-- 右边门 -->
<div class="door" style="right:30px;" data-target="archive.html">
  <div class="room-bar">Archive</div>
</div>

<!-- 角色 -->
<div id="character"></div>

<!-- Mission Control 滑出面板 -->
<div id="mission-panel">
  <span id="close-mission">✖</span>
  <iframe src="missioncontrol.html" allowfullscreen></iframe>
</div>

<!-- 红色闪烁 Overlay -->
<div id="alert-overlay"></div>

<script>
const character = document.getElementById("character");
const doors = document.querySelectorAll(".door");
const missionPanel = document.getElementById("mission-panel");
const closeMission = document.getElementById("close-mission");

let x=0, y=0;
const speed=10;
let facingRight=true;
let groundOffset=window.innerHeight*0.05;
let sway=0, swayDir=1;

function initPosition(){
  x = (window.innerWidth - character.offsetWidth)/2;
  y = window.innerHeight - character.offsetHeight - groundOffset;
}

function updateCharacter(){
  sway += swayDir*0.2;
  if(sway>4 || sway<-4) swayDir*=-1;

  character.style.left = `${x}px`;
  character.style.top = `${y + sway}px`;
  character.style.transform = `scaleX(${facingRight?1:-1})`;
}

function checkCollision(){
  let collided = null;
  const charBox = character.getBoundingClientRect();
  doors.forEach(d=>{
    const r = d.getBoundingClientRect();
    if(charBox.right>r.left && charBox.left<r.right && charBox.bottom>r.top && charBox.top<r.bottom){
      d.classList.add("active");
      collided=d;
    } else d.classList.remove("active");
  });
  return collided;
}

window.addEventListener('load', initPosition);
window.addEventListener('resize', initPosition);

function loop(){
  updateCharacter();
  requestAnimationFrame(loop);
}
loop();

document.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft'){ x-=speed; facingRight=false; e.preventDefault(); }
  if(e.key==='ArrowRight'){ x+=speed; facingRight=true; e.preventDefault(); }
  if(e.key==='ArrowUp'){ y-=speed; e.preventDefault(); }
  if(e.key==='ArrowDown'){ y+=speed; e.preventDefault(); }

  const maxX = window.innerWidth - character.offsetWidth;
  const maxY = window.innerHeight - character.offsetHeight - groundOffset/2;
  x = Math.max(0, Math.min(maxX, x));
  y = Math.max(0, Math.min(maxY, y));

  const collided = checkCollision();

  if(e.key==='Enter'||e.key===' '){
    if(collided){
      if(collided.dataset.type==='mission'){
        missionPanel.classList.add('active'); // 打开 Mission Control 面板
      } else if(collided.dataset.target){
        window.location.href = collided.dataset.target;
      }
    }
  }
});

closeMission.onclick = ()=> missionPanel.classList.remove('active');
</script>

</body>
</html>
