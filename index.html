<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Room 1</title>
<style>
body {
  margin: 0;
  height: 100vh;
  background: url('researchlab.png') no-repeat center center/cover;
  position: relative;
  overflow: hidden;
}

.door { 
  position:absolute; 
  top:50%; 
  transform:translateY(-50%); 
  width:70px; 
  height:30vh; 
  display:flex; 
  justify-content:center; 
  align-items:flex-end; 
  z-index:9; 
}

.room-bar { 
  width:max-content; 
  min-width:100px; 
  padding:5px 14px; 
  background:rgba(0,0,0,0.6); 
  color:white; 
  text-align:center; 
  font-size:14px; 
  border-radius:0 0 5px 5px; 
  opacity:0; 
  transform:translateY(100%); 
  transition:all 0.3s ease; 
  pointer-events:none; 
  z-index:10; 
}

.door.active .room-bar { 
  opacity:1; 
  transform:translateY(0); 
}

#character {
  position:absolute;
  width:15vw;
  aspect-ratio:2/3;
  background: url('1234.png') no-repeat center/contain;
  pointer-events:none;
  z-index:5;
  /* 镜像翻转 + 动画 */
  transition: transform 0.3s ease-in-out; /* 平滑转向 */
}
</style>
</head>
<body>

<!-- 左边门 -->
<div class="door" style="left:30px;" data-target="simulationlab.html">
  <div class="room-bar">Simulation Lab</div>
</div>

<!-- Mission Control 门 -->
<div class="door" style="left:35%;" data-target="missioncontrol.html">
  <div class="room-bar">Mission Control</div>
</div>

<!-- Exit 门 -->
<div class="door" style="left:65%;" data-target="index.html">
  <div class="room-bar">Exit</div>
</div>

<!-- 右边门 -->
<div class="door" style="right:30px;" data-target="archive.html">
  <div class="room-bar">Archive</div>
</div>

<!-- 角色 -->
<div id="character"></div>

<script>
const character = document.getElementById("character");
const doors = document.querySelectorAll(".door");

let x=0, y=0;
const speed=10;
let facingRight=true;
let groundOffset=window.innerHeight*0.05;

// 摇摆参数
let sway=0, swayDir=1;

function initPosition(){
  x = (window.innerWidth - character.offsetWidth)/2;
  y = window.innerHeight - character.offsetHeight - groundOffset;
}

function updateCharacter(){
  // 摇摆
  sway += swayDir*0.2;
  if(sway>4 || sway<-4) swayDir*=-1;

  character.style.left = `${x}px`;
  character.style.top = `${y + sway}px`;
  // 镜像翻转
  character.style.transform = `scaleX(${facingRight?1:-1})`;
}

function checkCollision(){
  let collided = null;
  const charBox = character.getBoundingClientRect();
  doors.forEach(d=>{
    const r = d.getBoundingClientRect();
    if(charBox.right>r.left && charBox.left<r.right && charBox.bottom>r.top && charBox.top<r.bottom){
      d.classList.add("active");
      collided=d;
    } else d.classList.remove("active");
  });
  return collided;
}

window.addEventListener('load', initPosition);
window.addEventListener('resize', initPosition);

function loop(){
  updateCharacter();
  requestAnimationFrame(loop);
}
loop();

document.addEventListener('keydown', e=>{
  if(e.key==='ArrowLeft'){ x-=speed; facingRight=false; e.preventDefault(); }
  if(e.key==='ArrowRight'){ x+=speed; facingRight=true; e.preventDefault(); }
  if(e.key==='ArrowUp'){ y-=speed; e.preventDefault(); }
  if(e.key==='ArrowDown'){ y+=speed; e.preventDefault(); }

  const maxX = window.innerWidth - character.offsetWidth;
  const maxY = window.innerHeight - character.offsetHeight - groundOffset/2;
  x = Math.max(0, Math.min(maxX, x));
  y = Math.max(0, Math.min(maxY, y));

  checkCollision();

  if(e.key==='Enter'||e.key===' '){
    const collided = checkCollision();
    if(collided && collided.dataset.target) window.location.href = collided.dataset.target;
  }
});
</script>

</body>
</html>


